<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ArrayListæµ…æ | Lybvinci&#39;s blob</title>
<meta name="description" content="å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†ã€‚">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://lybvinci.github.io/favicon.ico?v=1560345938091">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://lybvinci.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://lybvinci.github.io">
        <img src="https://lybvinci.github.io/images/avatar.png?v=1560345938091" class="site-logo">
        <h1 class="site-title">Lybvinci&#39;s blob</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://lybvinci.github.io" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      å­¦è€Œä¸æ€åˆ™ç½”ï¼Œæ€è€Œä¸å­¦åˆ™æ®†ã€‚
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://lybvinci.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ArrayListæµ…æ</h2>
            <div class="post-date">2019-06-02</div>
            
            <div class="post-content">
              <h2 id="0x00-å‰è¨€">0x00 å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ ArrayListï¼Œ åº”è¯¥æ˜¯å¤§å®¶éƒ½è€³ç†Ÿèƒ½è¯¦çš„å®¹å™¨ä¹‹ä¸€äº†ã€‚å­¦ä¹ ä¸€ä¸‹å†…ä¸­åŸç†ï¼Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚è‡³äºä¸ºä»€ä¹ˆå«æµ…æå‘¢ï¼Œå› ä¸ºæœ¬æ–‡ä¸ä¼šåˆ†æ Arrays çš„ç›¸å…³æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆä¸åˆ†æ Arrays çš„ç›¸å…³æ–¹æ³•ï¼Œå°±æ˜¯æµ…æäº†å‘¢ï¼Ÿé‚£å°±æ¥ç€å¾€ä¸‹çœ‹~ï¼ˆæœ¬æ–‡åˆ†ææºç åŸºäº<code>jdk1.8</code>ã€‚æœ¬æ–‡åŸºäºç¬¬ä¸€äººç§°æè¿°ï¼Œæˆ‘ == ArrayListã€‚ï¼‰</p>
<!-- more --> 
<h2 id="0x01-ä¸€å¥è¯ä»‹ç»">0x01 ä¸€å¥è¯ä»‹ç»</h2>
<p>æˆ‘å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æ‰©å®¹çš„æ•°ç»„ï¼Œå¹¶å¯ä»¥è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</p>
<h2 id="0x02-æ¦‚è¿°">0x02 æ¦‚è¿°</h2>
<p>æˆ‘æ˜¯<code>list</code>æ¥å£çš„ä¸€ä¸ªå¯æ‰©å®¹å®ç°ã€‚é€šè¿‡ Java çš„æ³›å‹æœºåˆ¶ï¼Œæˆ‘å¯ä»¥å®¹çº³ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚æˆ‘å’Œ <code>Vector</code> éå¸¸åƒï¼Œä½†æˆ‘æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œè€Œä»–æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…¶ä»–åœ°æ–¹çš„å·®å¼‚å¾ˆå°ã€‚</p>
<p>æˆ‘æ‰€æœ‰æ–¹æ³•ä¸­ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„æœ‰ï¼š</p>
<ul>
<li>size</li>
<li>get</li>
<li>isEmpty</li>
<li>set</li>
<li>iterator</li>
<li>listIterator
è€Œ<code>add</code>æ–¹æ³•æ˜¯O(n)çš„ã€‚</li>
</ul>
<p>æˆ‘çš„æ¯ä¸ªå®ä¾‹ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>capacity</code>å˜é‡ã€‚é‚£ä¹ˆè¿™ä¸ªå˜é‡æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿè¿™ä¸ªå˜é‡ç”¨äºè¡¡é‡æˆ‘å†…åœ¨çš„æ•°ç»„ç”¨æ¥è£…å˜é‡çš„é•¿åº¦ï¼Œä»–æ€»æ˜¯å¤§äºç­‰äº size ã€‚å½“æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°æˆ‘è¿™é‡Œï¼Œä»–ä¼šè‡ªåŠ¨çš„å¢é•¿ï¼Œä»¥æ»¡è¶³éœ€è¦ã€‚</p>
<p>å¦‚æœä¸€ä¸ªåº”ç”¨ä»–éœ€è¦å¾€æˆ‘è¿™é‡Œæ”¾ç½®å¾ˆå¤šçš„å…ƒç´ ï¼Œé‚£æœ€å¥½ä¸€å¼€å§‹å°±è®¾ç½®æˆ‘çš„ ensureCapacity å˜é‡ï¼Œè¿™æ ·æˆ‘ä¸€å¼€å§‹å°±ç”³è¯·å¾ˆå¤šçš„ç©ºé—´ï¼Œè€Œä¸ç”¨æˆ‘ä¸€æ¬¡æ¬¡æ‰©å®¹æµªè´¹æ—¶é—´äº†ã€‚</p>
<p><code>è¯·æ³¨æ„ï¼Œæˆ‘ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</code>å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æˆ‘ï¼Œä¸€ä¸ªè¦è®¾ç½®åŒæ­¥ï¼Œå¦åˆ™ä¼šå‡ºç°æ•°æ®é”™è¯¯çš„æƒ…å†µï¼Œè¿™ä¸ªé”…ï¼Œæˆ‘æ˜¯ä¸èƒŒçš„ã€‚ç®€å•çš„æ–¹å¼å°±æ˜¯ç”¨<code>Collections#synchronizedList</code>æ¥åŒ…è£…ä¸€ä¸‹æˆ‘ï¼Œæˆ‘å°±å˜æˆä¸€ä¸ªåŒæ­¥çš„å®¹å™¨äº†ã€‚</p>
<p>æˆ‘åŒæ ·æ‹¥æœ‰<code>fail-fast</code>æœºåˆ¶ï¼Œå¦‚æœä½ è¿­ä»£æˆ‘ï¼ŒåŒæ—¶åˆä¿®æ”¹æˆ‘ï¼Œæˆ‘å°±ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼Œè®©ä½ æ‰¿å—ã€‚å¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹è¿­ä»£ï¼Œä¹Ÿä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="0x03-è§£é‡Šå‡ ä¸ªå˜é‡">0x03 è§£é‡Šå‡ ä¸ªå˜é‡</h2>
<h4 id="private-static-final-int-default_capacity-10">private static final int DEFAULT_CAPACITY = 10</h4>
<p>é»˜è®¤çš„æ•°ç»„å¤§å°ã€‚</p>
<h4 id="private-static-final-object-defaultcapacity_empty_elementdata">private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}</h4>
<p>å¦‚æœæ„é€ æˆ‘æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯é»˜è®¤çš„ capacity ï¼Œå°±ä½¿ç”¨ DEFAULTCAPACITY_EMPTY_ELEMENTDATA æ¥å½“åšé»˜è®¤çš„ç©ºæ•°ç»„ã€‚</p>
<h4 id="private-static-final-object-empty_elementdata">private static final Object[] EMPTY_ELEMENTDATA = {}</h4>
<p>capacity == 0 ï¼Œåˆ™ä½¿ç”¨ EMPTY_ELEMENTDATA æ¥å½“åšé»˜è®¤çš„ç©ºæ•°ç»„ã€‚æ­¤æ—¶ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦å¼„ä¸¤ä¸ªè¿™æ ·çš„å˜é‡å‘¢ï¼Ÿåé¢æˆ‘ä»¬åœ¨æ‰©å®¹çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ï¼Œä»–ä»¬æ˜¯ç”¨æ¥åŒºåˆ†åˆ°åº•æ˜¯è¢«è®¾ç½®äº† capacity æ˜¯ 0 ï¼Œè¿˜æ˜¯ä½¿ç”¨äº†é»˜è®¤çš„ capacityã€‚é‚£åŒºåˆ†è¿™ä¸ªå¹²å˜›å‘¢ï¼Ÿé‚£å°±å¾€ä¸‹çœ‹çœ‹æ‰©å®¹æ˜¯æ€ä¹ˆæ‰©çš„ã€‚</p>
<h4 id="transient-object-elementdata">transient Object[] elementData</h4>
<p>å…ˆè§£é‡Šä¸€ä¸‹ <code>transient</code> è¿™ä¸ªï¼Œè¿™ä¸ªä¸»è¦æ˜¯è®©æ­¤å˜é‡ä¸è¿›è¡Œåºåˆ—åŒ–ã€‚æ›´å¤šçš„å¯ä»¥è°·æ­Œä¸€ä¸‹ï¼Œçœ‹çœ‹è¯¦è§£ï¼Œæ­¤å¤„å°±ç•¥è¿‡äº†ã€‚è¿™ä¸ªå°±æ˜¯æˆ‘çš„æ ¸å¿ƒéƒ¨ä»¶ï¼Œæˆ‘æ‰€æœ‰çš„å…ƒç´ éƒ½æ”¾åœ¨ä»–é‡Œé¢ï¼å®è´¨å°±æ˜¯ä¸€ä¸ª Object æ•°ç»„ï¼</p>
<h4 id="private-int-size">private int size</h4>
<p>æƒ³è¦çŸ¥é“æˆ‘é‡Œé¢åˆ°åº•æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Ÿå–ï¼Œsize å°±æ˜¯æˆ‘æ‰€æ‹¥æœ‰çš„å…ƒç´ æ•°é‡ã€‚</p>
<h2 id="0x04-æ–¹æ³•åˆ†æ">0x04 æ–¹æ³•åˆ†æ</h2>
<h3 id="æ„é€ å‡½æ•°åˆ†æ">æ„é€ å‡½æ•°åˆ†æ</h3>
<pre><code>// æ‹¥æœ‰è®¾ç½® capacity å‚æ•°çš„æ„é€ å‡½æ•°
public ArrayList(int initialCapacity) {
    if (initialCapacity &gt; 0) {  // å¦‚æœè®¾ç½®çš„ initialCapacity åˆå§‹å€¼å¤§äº0ï¼Œé‚£æˆ‘çš„æ•°ç»„å°±åˆå§‹ç›¸åº”çš„é•¿åº¦
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) { 
        // å¦‚æœè®¾ç½®äº† 0 ï¼Œé‚£å°±ç”¨ EMPTY_ELEMENTDATA æ¥åˆå§‹åŒ–æˆ‘çš„æ•°ç»„ã€‚
        this.elementData = EMPTY_ELEMENTDATA;
    } else { // å°äº 0 ï¼ŒæŠ›å‡ºå¼‚å¸¸
        throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+
                                           initialCapacity);
    }
}

// æ— å‚æ„é€ 
public ArrayList() {
    // ç›´æ¥ç”¨ DEFAULTCAPACITY_EMPTY_ELEMENTDATA æ¥åˆå§‹åŒ–æˆ‘çš„æ•°ç»„ã€‚
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}
// è¿˜æœ‰å…¶ä»–æ„é€ å‡½æ•°ï¼Œæ­¤å¤„ç•¥å»ä¸è®²ã€‚
</code></pre>
<h3 id="size">size()</h3>
<p>æ­¤æ–¹æ³•ç”¨äºæŸ¥çœ‹æˆ‘æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œæ¥çœ‹çœ‹å®ç°ã€‚</p>
<pre><code>public int size() {
    // éå¸¸ç®€å•ï¼Œå°±æ˜¯è¿”å› size å˜é‡ã€‚
    return size;
}
</code></pre>
<h3 id="getint-index">get(int index)</h3>
<p>get æ–¹æ³•ç”¨æ¥è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚</p>
<pre><code>public E get(int index) {
    // æ£€æŸ¥ç´¢å¼•æ˜¯å¦è¶Šç•Œ
    rangeCheck(index);
    // ç›´æ¥æ ¹æ®ç´¢å¼•è¿”å›å…ƒç´ 
    return elementData(index);
}

private void rangeCheck(int index) {
    // å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç´¢å¼•å¤§äºç­‰äº sizeï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ä¸èƒ½ä¼ å…¥é”™è¯¯çš„ç´¢å¼•ï¼Œå¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚
    if (index &gt;= size)
        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
}
</code></pre>
<h3 id="setint-index-e-element">set(int index, E element)</h3>
<p>è¿™ä¸ªæ–¹æ³•ç›¸å½“äºä¿®æ”¹æ“ä½œã€‚</p>
<pre><code>public E set(int index, E element) {
    // æ£€æŸ¥è¾¹ç•Œ
    rangeCheck(index);
    // å…ˆæ‹¿åˆ°è€çš„å…ƒç´ 
    E oldValue = elementData(index);
    // å¯¹åº”ä½ç½®é™„ä¸Šæ–°å…ƒç´ 
    elementData[index] = element;
    // è¿”å›è€å…ƒç´ ã€‚æ‰€ä»¥ set æ–¹æ³•çš„è¿”å›æ˜¯å¯¹åº”çš„æ—§å…ƒç´ ã€‚
    return oldValue;
}
</code></pre>
<h3 id="adde-e">add(E e)</h3>
<p>è¿™ä¸ªæ–¹æ³•ç›¸å½“äºå¢åŠ æ“ä½œã€‚</p>
<pre><code>public boolean add(E e) {
    // ç¡®ä¿æ•°ç»„ç©ºé—´å……è¶³
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    // å°†å…ƒç´ æ”¾åˆ°åŸæ•°ç»„é•¿åº¦åé¢ä¸€ä½ã€‚
    elementData[size++] = e;
    return true;
}
private void ensureCapacityInternal(int minCapacity) {
    // è¿™é‡Œä½¿ç”¨äº† DEFAULTCAPACITY_EMPTY_ELEMENTDATA ã€‚
    // è¿™ä¸ªå˜é‡æ˜¯åœ¨æˆ‘åˆå§‹åŒ–æ—¶ï¼Œä½¿ç”¨äº†é»˜è®¤çš„ capacity çš„æ—¶å€™ï¼Œç”¨æ¥åˆå§‹åŒ–æ•°ç»„çš„ã€‚
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        // åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å°†å…¥å‚å’Œ é»˜è®¤ capacity è¿›è¡Œæ¯”è¾ƒï¼Œå–å…¶è¾ƒå¤§å¤§è€…ã€‚
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    // æ ¹æ®ä¸Šé¢çš„æ“ä½œï¼Œå†³å®šäº†ä½¿ç”¨ä»€ä¹ˆé•¿åº¦æ¥æ‰©å®¹ã€‚ä¸‹é¢æ¥è¿›è¡Œæ‰©å®¹ã€‚
    ensureExplicitCapacity(minCapacity);
}

private void ensureExplicitCapacity(int minCapacity) {
    // å¦‚æœä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œå°±ä»£è¡¨ä¼šæ”¹å˜æ•°ç»„ï¼Œåˆ™å°†æ”¹å˜æ ‡å¿—ä½+1.
    modCount++;

    // åŸæ–‡æ³¨é‡Šè¿™é‡Œè¯´å¯èƒ½ä¼šæœ‰å†…å­˜æº¢å‡º
    if (minCapacity - elementData.length &gt; 0) // å¦‚æœå¤§äºæ•°ç»„é•¿åº¦ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ã€‚
        grow(minCapacity);
}

// æˆ‘å†…éƒ¨çš„æ•°ç»„æœ€å¤§å¯ä»¥è¿™ä¹ˆå¤§ï¼Œä¸ºä»€ä¹ˆå‡äº†ä¸ª8å‘¢ï¼Ÿå› ä¸ºæœ‰äº›VMåº•å±‚å®ç°ï¼Œä¿ç•™äº†ä¸€äº›å†…éƒ¨å­—æ®µï¼Œè‡´ä½¿ç•™ç»™ç”¨æˆ·çš„é•¿åº¦å°±å˜å°äº†ã€‚
private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;

private void grow(int minCapacity) {
    // è¦æ³¨æ„æ˜¯å¦ä¼šæº¢å‡ºã€‚
    // å…ˆä¿å­˜æ•°ç»„çš„åŸé•¿åº¦ã€‚
    int oldCapacity = elementData.length;
    // æ–°é•¿åº¦æ˜¯åŸé•¿åº¦çš„1.5å€ã€‚ï¼ˆå³ç§»ç›¸å½“äºé™¤ä»¥2ï¼Œæ‰€ä»¥åŠ èµ·æ¥æ˜¯1.5å€ï¼‰
    int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);
    if (newCapacity - minCapacity &lt; 0) // å¦‚æœæ–°é•¿åº¦å°äºå…¥å‚é•¿åº¦ï¼Œåˆ™æ–°é•¿åº¦èµ‹å€¼ä¸ºå…¥å‚é•¿åº¦ã€‚
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE &gt; 0) // å¦‚æœæ–°é•¿åº¦å¤§äºæ•°ç»„æœ€å¤§é•¿åº¦ï¼Œåˆ™è°ƒç”¨ hugeCapacity æ–¹æ³•è·å–é•¿åº¦ã€‚
        newCapacity = hugeCapacity(minCapacity);
    // è°ƒç”¨äº† Arrays çš„æ–¹æ³•ï¼Œå¯¹æ•°ç»„è¿›è¡Œäº†ä¸€ä¸ªå¤åˆ¶ã€‚
    // åº•å±‚å°±ä¸è§£é‡Šäº†ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæŠŠåŸ elementData æ•°ç»„ä¸­çš„å€¼ï¼Œä¸€ä¸ªä¸ªéƒ½æ¬ç§»åˆ°äº†æ–°çš„é•¿åº¦ä¸º newCapacity çš„æ•°ç»„ä¸­ï¼Œç„¶åè®© elementData æŒ‡å‘æ–°æ•°ç»„ã€‚
    //ï¼ˆç”±äºæ²¡æœ‰è§£æ Arrays.copy æ–¹æ³•ï¼Œæ‰€ä»¥æœ¬æ–‡åªèƒ½ç®—æµ…æï¼Œåé¢ç›¸å…³æ“ä½œï¼Œä¹Ÿä¸ä¼šè¿›è¡Œè§£æã€‚è¦è§£æçš„è¯ï¼Œä¸€ç¯‡æ–‡ç« å¯èƒ½å°±æ”¾ä¸ä¸‹äº†ã€‚ä»¥åä¸“å¼€æ–‡ç« ä»‹ç»è¿™äº›å·¥å…·ç±»ã€‚ï¼‰
    elementData = Arrays.copyOf(elementData, newCapacity);
}

private static int hugeCapacity(int minCapacity) {
    if (minCapacity &lt; 0) // å¦‚æœ ä¼ é€’è¿›æ¥çš„å‚æ•°å°äº0ï¼Œåˆ™ç›´æ¥æŠ›å¼‚å¸¸ï¼Œæ­¤æ—¶æ•°ç»„å·²ç»æ”¾ä¸ä¸‹äº†ã€‚
        // ä»€ä¹ˆæ—¶å€™ä¼šå°äº0å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°å‚æ•°æ˜¯é€šè¿‡ index + 1 ä¼ é€’è¿›æ¥çš„ï¼Œå½“index å·²ç»åˆ°è¾¾äº† Integer.MAX_VALUEï¼Œåˆ™ä¼šå‡ºç°æ­¤æƒ…å†µã€‚
        throw new OutOfMemoryError();
    // å‘ç°å‚æ•°æ¯”è®¾ç½®çš„æœ€å¤§é•¿åº¦è¿˜è¦å¤§ï¼Œé‚£è¡Œå§ï¼Œé‚£å°±è¿”å›æœ€å¤§å€¼ï¼Œä¸ç„¶å°±ç›´æ¥è¿”å›æœ€å¤§çš„æ•°ç»„é•¿åº¦ã€‚
    return (minCapacity &gt; MAX_ARRAY_SIZE) ?
        Integer.MAX_VALUE :
        MAX_ARRAY_SIZE;
}
</code></pre>
<h3 id="addint-index-e-element">add(int index, E element)</h3>
<p>è¿™ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ’å…¥æ“ä½œã€‚</p>
<pre><code>public void add(int index, E element) {
    // èŒƒå›´æ£€æŸ¥
    rangeCheckForAdd(index);

    // å®¹é‡æ£€æŸ¥
    ensureCapacityInternal(size + 1);  // modCountå¢åŠ äº†
    // ç›´æ¥è°ƒç”¨äº† System.arraycopy æ–¹æ³•ã€‚
    // è¿™é‡Œä¹Ÿä¸å»åˆ†æä»–åº•å±‚çš„æºç ï¼Œå»åˆ†æä¹Ÿä¸å¤ªå®¹æ˜“ï¼Œä»–å®é™…ä¸Šæ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œè¦çœ‹åªèƒ½å»çœ‹ jni å±‚çš„ä»£ç äº†ã€‚
    // è§£é‡Šä¸€ä¸‹ç°åœ¨å‚æ•°æ‰€è¡¨ç¤ºçš„æ„æ€ï¼šå°±æ˜¯å°†æ•°ç»„æ ¹æ®ä¼ å…¥çš„ index åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç„¶åæŠŠåé¢ä¸€éƒ¨åˆ†å¾€åé¢æ•´ä½“ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œindexä½ç½®ç•™å‡ºç©ºä½ã€‚
    // ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæºæ•°ç»„
    // ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºä»å“ªä¸ªä½ç½®å¼€å§‹å¤åˆ¶
    // ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºå¤åˆ¶åˆ°å“ªä¸ªæ•°ç»„ä¸­
    // ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå¤åˆ¶ä»å“ªé‡Œå¼€å§‹
    // ç¬¬äº”ä¸ªå‚æ•°è¡¨ç¤ºå¤åˆ¶å¤šå°‘ä½
    System.arraycopy(elementData, index, elementData, index + 1,
                     size - index);
    // å°† index ä½ç½®è¿›è¡Œå¡«å……
    elementData[index] = element;
    // é•¿åº¦è‡ªå¢
    size++;
}
ä¸¾ä¸ªğŸŒ°è§£é‡Šä¸€ä¸‹ System.arraycopy çš„æ“ä½œã€‚
æœ‰ä¸€ä¸ªæ•°ç»„å¦‚ä¸‹ï¼š
[0,1,2,3,4,5,6,null,null,null]
ç°åœ¨å¦‚æœè¦åœ¨ç¬¬äºŒä½æ’å…¥ä¸€ä¸ªæ•°å­—7.
ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°ç¬¬2ä¸ªä½ç½®ï¼Œæ˜¯2ï¼›
ç¬¬äºŒæ­¥ï¼šæŠŠç¬¬äºŒä½å¼€å§‹çš„å­—æ®µæ•´ä½“å¾€åè¿ç§»ä¸€ä½ï¼Œå˜æˆï¼š[0,1,2,2,3,4,5,6,null,null]
æ­¤æ—¶æ•°ç»„å·²ç»ç§»åŠ¨å®Œæ¯•ï¼Œå†è¿›è¡Œèµ‹å€¼å³å¯ã€‚
</code></pre>
<p>é€šè¿‡æºç çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°æ’å…¥å®é™…ä¸Šæ˜¯å…ˆå¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ç§»åŠ¨ï¼Œè€—è´¹å·¨å¤§ã€‚æ‰€ä»¥åº”å½“é¿å…æ­¤æ“ä½œã€‚</p>
<h3 id="removeint-index">remove(int index)</h3>
<p>æ­¤å³åˆ é™¤æ“ä½œã€‚</p>
<pre><code>public E remove(int index) {
    // è¾¹ç•Œæ£€æŸ¥
    rangeCheck(index);
    // ä¿®æ”¹è®¡æ•°
    modCount++;
    // æ‰¾åˆ°æ—§å€¼
    E oldValue = elementData(index);
    // è®¡ç®—éœ€è¦ç§»åŠ¨å¤šå°‘ä¸ªå…ƒç´ ã€‚
    int numMoved = size - index - 1;
    if (numMoved &gt; 0)
        // å’Œ ä¸Šé¢çš„ add æ“ä½œè°ƒç”¨ï¼Œå¦‚å‡ºä¸€è¾™ã€‚
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // åˆ©äºå†…å­˜å›æ”¶
    // è¿”å›æ—§å€¼
    return oldValue;
}
</code></pre>
<p>å¯ä»¥å‘ç°ï¼Œåˆ é™¤æ“ä½œä¹Ÿæ¯”è¾ƒè´¹åŠ²ï¼Œé™¤éæ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p>
<h3 id="removeobject-o">remove(Object o)</h3>
<p>åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œå¯ä»¥æƒ³è±¡ï¼Œè‚¯å®šæ˜¯ä¸€ä¸ªä¸ªçš„éå†ç„¶åå¯¹æ¯”ï¼Œå†æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p>
<pre><code>public boolean remove(Object o) {
    // null å’Œ é null åˆ†å¼€å¤„ç†ï¼Œç§ä»¥ä¸ºï¼Œç›´æ¥ä½¿ç”¨ Objects.equals æ–¹æ³•ä¸å°±å¥½äº†ä¹ˆã€‚
    if (o == null) {
        for (int index = 0; index &lt; size; index++)
            if (elementData[index] == null) {
                fastRemove(index);
                return true;
            }
    } else {
        for (int index = 0; index &lt; size; index++)
            // å¯ä»¥çœ‹åˆ°ä»–è°ƒç”¨çš„æ˜¯ equals æ–¹æ³•ï¼Œç„¶è€Œæ²¡æœ‰è°ƒç”¨ == æ¥åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚
            // æ‰€ä»¥æ­¤å¤„è¦æ³¨æ„ï¼Œå¦‚æœé‡å†™äº† equals æ–¹æ³•ï¼Œåˆ™åŒä¸€ä¸ªå¯¹è±¡æœªå¿…ç›¸ç­‰ã€‚è¿™é‡Œå¯èƒ½å°±è¯†åˆ«ä¸åˆ°ã€‚
            if (o.equals(elementData[index])) {
                fastRemove(index);
                return true;
            }
    }
    return false;
}
// è¿™ä¸ªæ–¹æ³•å’Œ remove çš„ä¸Šä¸€ä¸ªæ–¹æ³•é‡Œé¢çš„å†…å®¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¸çŸ¥é“ä¸Šä¸ª remove æ–¹æ³•ä¸ç”¨ã€‚
private void fastRemove(int index) {
    modCount++;
    int numMoved = size - index - 1;
    if (numMoved &gt; 0)
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // clear to let GC do its work
}
</code></pre>
<h3 id="clear">clear()</h3>
<p>æ¸…ç©ºæ­¤ listã€‚</p>
<pre><code>public void clear() {
    modCount++;

    // æŒ¨ä¸ªèµ‹å€¼ null
    for (int i = 0; i &lt; size; i++)
        elementData[i] = null;

    size = 0;
}
</code></pre>
<h3 id="containsobject-o-indexofobject-o">contains(Object o) &amp;&amp; indexOf(Object o)</h3>
<p>ä¸ºä»€ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•æ”¾åœ¨ä¸€èµ·å‘¢ï¼Œå› ä¸ºä»–ä»¬ä¹‹é—´æ˜¯å¥½åŸºå‹çš„å…³ç³»ã€‚</p>
<pre><code>public boolean contains(Object o) {
    // å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥è°ƒç”¨çš„ indexOf æ–¹æ³•ã€‚
    return indexOf(o) &gt;= 0;
}

public int indexOf(Object o) {
    // è¿˜æ˜¯å°† null å’Œ é null è¿›è¡Œäº†åŒºåˆ†å¤„ç†ã€‚æ˜¯ä¸æ˜¯ä¼¼æ›¾ç›¸è¯†çš„ä»£ç ï¼remove ä¸ä¹Ÿè¿™ä¹ˆåšçš„ä¹ˆï¼
    if (o == null) {
        for (int i = 0; i &lt; size; i++)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = 0; i &lt; size; i++)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}
</code></pre>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œ contains å’Œ indexOf å®é™…ä¸Šéƒ½æ˜¯å¯¹æ•°ç»„è¿›è¡Œä¸€ä¸ªéå†æ“ä½œï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€å®šè¦è°¨æ…ã€‚è€Œ Set æ–¹æ³•çš„ contains æ–¹æ³•æ˜¯ç›´æ¥ç”¨çš„ hash è®¡ç®—çš„ï¼Œå¤æ‚åº¦æ˜¯ O(1).æ‰€ä»¥å°½é‡ç”¨ Set è¿›è¡Œç±»ä¼¼æ“ä½œã€‚</p>
<h3 id="sublistint-fromindex-int-toindex">subList(int fromIndex, int toIndex)</h3>
<p>ä»å­—é¢ä¸Šçœ‹ï¼Œä»–å°±æ˜¯è¿”å›ä¸€ä¸ªæˆ‘çš„å­©å­ listã€‚</p>
<pre><code>public List&lt;E&gt; subList(int fromIndex, int toIndex) {
    // è¾¹ç•Œæ£€æŸ¥
    subListRangeCheck(fromIndex, toIndex, size);
    // è¿”å›ä¸€ä¸ª SubList ç±»ï¼ç«Ÿç„¶ä¸æ˜¯ ArrayList
    return new SubList(this, 0, fromIndex, toIndex);
}

çœ‹çœ‹å†…éƒ¨ç±» SubList çš„å£°æ˜ï¼š
private class SubList extends AbstractList&lt;E&gt; implements RandomAccess
å’Œ ArrayList ç«Ÿç„¶ä¸ä¸€æ ·ã€‚
é‚£å°±çœ‹çœ‹æ„é€ å‡½æ•°å§ï¼š

SubList(AbstractList&lt;E&gt; parent,
        int offset, int fromIndex, int toIndex) {
    // parent å½“ç„¶å°±æ˜¯æˆ‘å’¯ï¼ŒArrayList
    this.parent = parent;
    // ç›¸å¯¹æˆ‘çš„åç§»é‡ï¼Œå°±æ˜¯å­©å­æ˜¯ä»å“ªå¼€å§‹æˆªå–çš„
    this.parentOffset = fromIndex;
    // å¦‚æœå„¿å­ä¹Ÿè¦ç”Ÿå„¿å­ï¼Œå°±æ˜¯äº§ç”ŸSubListï¼Œåˆ™è¦è®¡ç®—ç›¸å¯¹çˆ·çˆ·çš„åç§»é‡ï¼Œæ­¤å€¼å°±æ˜¯ä¸ºäº†æ¥è®¡ç®—è¿™ä¸ªã€‚
    // å¦‚æœè¦ç”Ÿé‡å­™å­ï¼Œé‚£å°±è¦è®¡ç®—ç›¸å¯¹äºç¥–çˆ·çˆ·çš„åç§»é‡ã€‚å­å­å­™å­™æ— ç©·å°½ä¹Ÿã€‚
    this.offset = offset + fromIndex;
    // è®¡ç®—å­©å­æœ‰å¤šé•¿ã€‚
    this.size = toIndex - fromIndex;
    // ç»§æ‰¿çˆ¶äº²çš„æ›´æ”¹è®¡æ•°ã€‚
    this.modCount = ArrayList.this.modCount;
}
çœ‹ä¸€ä¸‹ SubList æ–¹æ³•çš„ get æ–¹æ³•ã€‚
public E get(int index) {
    // æ£€æŸ¥è¾¹ç•Œ
    rangeCheck(index);
    // æ£€æŸ¥æ˜¯å¦å·²ç»è¢«ä¿®æ”¹
    checkForComodification();
    // åƒæƒŠå—ï¼Ÿç«Ÿç„¶ç›´æ¥ä¿®æ”¹çš„æ˜¯çˆ¶äº²çš„æ•°ç»„ã€‚
    return ArrayList.this.elementData(offset + index);
}
private void checkForComodification() {
    // å’Œçˆ¶äº²çš„ä¿®æ”¹è®¡æ•°è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ï¼Œå¦‚æœçˆ¶äº²å˜äº†ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
    if (ArrayList.this.modCount != this.modCount)
        throw new ConcurrentModificationException();
}
......
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSubList å®é™…ä¸Šå¹¶ä¸æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªå’ŒåŸæ•°ç»„å®Œå…¨åˆ†ç¦»çš„æ•°ç»„ï¼Œå¯¹äº SubList çš„ä¿®æ”¹ï¼Œå…¨éƒ½ä¼šä½œç”¨äºçˆ¶äº²è¿™é‡Œã€‚è¿™å°±å¥½æ¯”å„¿å­æƒ¹å¾—ç¥¸ï¼Œçˆ¶äº²éƒ½è¦æ¥èƒŒã€‚æ‰€ä»¥ä½¿ç”¨æ­¤æ–¹æ³•ä¸€å®šè¦æ³¨æ„ã€‚åŒç†ï¼Œç”Ÿå„¿å­ä¹Ÿè¦æ…é‡ï¼å“ˆå“ˆã€‚</p>
<h3 id="å…¶ä»–æ–¹æ³•å°±å…ˆç•¥è¿‡äº†">å…¶ä»–æ–¹æ³•å°±å…ˆç•¥è¿‡äº†</h3>
<h2 id="0x05-å–å£æ°´æ¥ä¸ªæ€»ç»“">0x05 å–å£æ°´ï¼Œæ¥ä¸ªæ€»ç»“</h2>
<p>ArrayList ç›¸å¯¹æ¥è¯´ç®€å•äº›ï¼Œä½†æ˜¯å…¶ä¸­ä¹Ÿä¸ä¹ contains subList è¿™ç§éœ€è¦æ³¨æ„çš„æ–¹æ³•ã€‚çŸ¥å·±çŸ¥å½¼ï¼Œæ–¹èƒ½ç™¾æˆ˜ä¸æ®†ï¼</p>
<p>æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œè¯·å¤§å®¶ä¸åèµæ•™ï¼æ„Ÿæ¿€ä¸å°½ï¼Œä¸å›å…±å‹‰ã€‚</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://lybvinci.github.io/tag/_dev" class="tag">
                    å¼€å‘
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://lybvinci.github.io/post/chang-yong-de-hashmap-dao-di-shi-ge-shi-me-jie-gou">
                  <h3 class="post-title">
                    å¸¸ç”¨çš„HashMapåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆç»“æ„
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '05581d7a551ffb1bd58c',
        clientSecret: '637336d63b878238482dd2645347ee86a7867eab',
        repo: 'lybvinci.github.io',
        owner: 'lybvinci',
        admin: ['lybvinci'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
